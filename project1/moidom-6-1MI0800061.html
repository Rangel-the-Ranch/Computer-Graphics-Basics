<!DOCTYPE html>

<!-- Рангел Плачков, група 6, 1MI0800061 -->

<html>
	<head>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<script src="three.min.js"></script>
		<script src="OrbitControls.js"></script>
	</head>
	
	<body>
		<script>
			const FN = '1MI0800061';
		</script>
		
		<script src="init.js"></script>
		<script src="CSG.js"></script>
			
		<script>

			let house = new THREE.Group();

			class Wall{
				static wallWight = 0.2;
				static wallHeight = 3;
				static wallPosY = Wall.wallHeight/2 - 0.01;
				static wallCount = 0;
				static wallsArr = [];

				static defaultColor = "yellow";
				static defaultShininess = 10;
				static defaultWindowsHeight = 2;
				static defaultDoorLen = 1;
				static defaultDoorHeight = 2;
				
				constructor(lenght, isXwall, posX, posZ){
					this.color = Wall.defaultColor;
					this.posX = posX;
					this.posY = Wall.wallPosY;
					this.posZ = posZ;
					this.lenghtY = Wall.wallHeight;
					
					if(isXwall){
						this.lenghtX =  lenght;
						this.lenghtZ = Wall.wallWight;
						
					}else{
						this.lenghtX = Wall.wallWight;
						this.lenghtZ = lenght;
					}
					this.geometry = new THREE.BoxGeometry( this.lenghtX, this.lenghtY, this.lenghtZ );
					this.material = new THREE.MeshPhongMaterial( {color: this.color, shininess: Wall.defaultShininess} );
					
					this.reRender();
				}
				reRender(){
					this.render = new THREE.Mesh( this.geometry, this.material );
					this.render.position.set( this.posX, this.posY, this.posZ );
				}
				shadows(recive,cast){
					this.render.receiveShadow = recive;
					this.render.castShadow = cast;
				}

				generateWall(){
					this.shadows(1,1);
					house.add(this.render);
				}
				addWindow(windowLen){
					const isXwall = (this.lenghtX > this.lenghtZ);
					let hole;
					if(isXwall){
						hole = new THREE.Mesh( new THREE.BoxGeometry( windowLen, Wall.defaultWindowsHeight, this.lenghtZ ));
					}else{
						hole = new THREE.Mesh( new THREE.BoxGeometry( this.lenghtX, Wall.defaultWindowsHeight, windowLen ));
					
					}
					
					const csg = new CSG();
					const tempRend = new THREE.Mesh( this.geometry )
					csg.subtract( [tempRend, hole] );

					this.render = csg.toMesh();
					this.render.material = this.material;
					this.render.position.set( this.posX, this.posY, this.posZ );
				}
				addDoor(){
					
					const isXwall = (this.lenghtX > this.lenghtZ);
					let hole;
					if(isXwall){
						hole = new THREE.Mesh( new THREE.BoxGeometry( Wall.defaultDoorLen, Wall.defaultDoorHeight, this.lenghtZ ));
					}else{
						hole = new THREE.Mesh( new THREE.BoxGeometry( this.lenghtX, Wall.defaultDoorHeight, Wall.defaultDoorLen ));
					
					}
					hole.position.set(0,this.posY-Wall.defaultDoorHeight,0);
					const csg = new CSG();
					const tempRend = new THREE.Mesh( this.geometry )
					csg.subtract( [tempRend, hole] );

					this.render = csg.toMesh();
					this.render.material = this.material;
					this.render.position.set( this.posX, this.posY, this.posZ );
				}
				paint(color){
					this.color = color;
					this.material = new THREE.MeshPhongMaterial( {color: this.color, shininess: Wall.defaultShininess} );
					reRender();
				}
				static newXWall(lenght,posX, posY){
					Wall.wallsArr[Wall.wallCount] = new Wall (lenght, 1, posX, posY);
					Wall.wallCount++;
				}
				static newZWall(lenght, posX, posY){
					Wall.wallsArr[Wall.wallCount] = new Wall (lenght, 0, posX, posY);
					Wall.wallCount++;
				}
				
				static generateAllWalls(){
					for(let i=0; i<Wall.wallCount; i++){
						Wall.wallsArr[i].generateWall();
					}
				}


			}
			
			Wall.defaultColor = "yellow";
			Wall.newZWall(6, 6.90 , 1);
			Wall.wallsArr[Wall.wallCount-1].addDoor();
			Wall.newXWall(2.2, 5.9 ,3.9);
			Wall.wallsArr[Wall.wallCount-1].addWindow(1);
			Wall.newZWall(4, 4.90 , 6);
			Wall.wallsArr[Wall.wallCount-1].addWindow(2);
			Wall.newXWall(8, 1 ,7.9);
			Wall.newZWall(4, -2.9 ,5.8);
			Wall.newXWall(4, -5 ,3.9);
			Wall.wallsArr[Wall.wallCount-1].addWindow(2);
			Wall.newZWall(6, -6.9 ,1);
			Wall.newXWall(4, -5 ,-1.9);	
			Wall.newZWall(4.2, -2.9 ,-3.9);
			Wall.newXWall(8, 1 ,-5.9);	
			Wall.wallsArr[Wall.wallCount-1].addWindow(5);
			Wall.newZWall(4, 4.90 , -4);
			Wall.newXWall(2.2, 5.9 ,-1.9);
			Wall.defaultColor = "lightyellow";
			Wall.newXWall(5, 1 ,-1.9);

			Wall.generateAllWalls();


			scene.add(house);

			var geometry = new THREE.BoxGeometry( 0.2, 0.2, 0.2 ),
				material = new THREE.MeshPhongMaterial( {color:'crimson', shininess: 100} );
				
			var cube = new THREE.Mesh( geometry, material );
				cube.position.set( 0.5, 0.1, 0.51 );
				cube.receiveShadow = true;
				cube.castShadow = true;
			
			scene.add( cube );
			
		</script>
		
	</body>
</html>


